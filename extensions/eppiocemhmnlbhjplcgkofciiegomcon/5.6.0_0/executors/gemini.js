(()=>{const y=(()=>{const y=sessionStorage.getItem("bis_data");return null!==y?JSON.parse(y):null})(),G=y?.config?`${y.id}_t`:null,Z=y?.config?.aiMessagesConfig?.GEMINI||{},{PARSERS:Q=[],CHATBOT_NAME:W=""}=Z,g=y=>{try{let Z={posdMessageId:"PANELOS_MESSAGE",posdHash:(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22),type:"GEMINI_DATA",from:G,to:G.substring(0,G.length-2),content:y};window.postMessage(Z)}catch(y){}},z=function(y,G,Z){try{p(y,Z.SENT_MESSAGE),c(G,Z.RECEIVED_MESSAGE)}catch(y){}},c=function(y,G){if(!y?.length)return;let Z="",Q=y.replace(new RegExp(G.REGEXP_REMOVE_GARBAGE),"").split(new RegExp(G.REGEXP_SPLITER)).map((y=>y.trim())).filter((y=>y)),W=[0,0];for(let y of Q){let G=Q.indexOf(y);W[1]<y.length&&(W[1]=y.length,W[0]=G)}if(G.RED_FLAG_VALUES_FOR_MEDIA.some((y=>Q[W[0]].includes(y))))return;let z=new RegExp(G.REGEXP_GET_MESSAGE_TEXT);if(Z=Q[W[0]].match(z)?.groups?.message,!Z)return;let c=A(Z,G);c&&g(c)},A=function(y,G){let Z={messageText:y,messageType:G.MESSAGE_TYPE,sessionId:self.location.href.match(new RegExp(G.REGEXP_SESSION_ID_FROM_URL))?.groups?.sessionId,chatbotName:W};return m(Z,G.MESSAGE_LENGTH||3e4),Z},p=function(y,G){if(!y?.length)return;let Z=decodeURIComponent(y),Q=Z.split(G.SEPARATOR_PARAMETERS)?.[0];if(!Q)return;let W=Q.replace(new RegExp(G.REPLACEMENT_PARAMETER,"g"),"");try{let y=K(W,G);y&&g(y)}catch(y){}},K=function(y,G){let Z=JSON.parse(JSON.parse(y)?.filter((y=>y)))?.filter((y=>y))?.[0]?.[0];if(!Z?.length)return;let Q=JSON.parse(JSON.parse(y)?.filter((y=>y)))?.filter((y=>y))?.[2]?.[0],g=self.location.href.match(new RegExp(G.REGEXP_SESSION_ID_FROM_URL))?.groups?.sessionId;if(!Q?.length&&!g?.length)return;let z={chatbotName:W,messageText:Z,sessionId:Q.length?Q.replace(new RegExp(G.REPLACEMENT_PREFIX_SESSION_ID),""):g,messageType:G.MESSAGE_TYPE};return m(z,G.MESSAGE_LIMIT||1e4),z},m=function(y,G){let Z=y.messageText,Q=Z.split("");"\\"===Q[Q.length-1]&&(Q[Q.length-1]="",Z=Q.join("")),y.messageText=Z.trim().slice(0,G),y.messageLength=Z.length};ParserProcessors={XMLHttpRequest:function(y){const G=XMLHttpRequest.prototype.open,Z=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(y,Z){return this._requestMethod=y,this._requestUrl=Z,G.apply(this,arguments)},XMLHttpRequest.prototype.send=function(G){let Q=this.onreadystatechange;return this.onreadystatechange=function(){try{4===this.readyState&&function(y,G,Z){return new RegExp(Z.REGEXP_URL_CHECK).test(y)&&G===Z.REQUEST_METHOD}(this._requestUrl,this._requestMethod,y)&&setTimeout(z.bind(this,G,this.responseText,y),0)}catch(y){if(Q)return Q.apply(this,arguments)}if(Q)return Q.apply(this,arguments)},Z.apply(this,arguments)}}};!function(){for(let y of Q)y.USE&&ParserProcessors[y.TYPE](y)}()})();