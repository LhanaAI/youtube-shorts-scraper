(()=>{const y=(()=>{const y=sessionStorage.getItem("bis_data");if(null!==y){return JSON.parse(y)}return null})(),G=y?.config?`${y.id}_t`:null,Z=y?.config?.aiMessagesConfig?.PERPLEXITY||{},{PARSERS:Q=[],CHATBOT_NAME:W=""}=Z;ParserProcessors={XMLHttpRequest:function(y){const G=fetch;fetch=async function(Z,Q={}){let W=Z instanceof Request?Z.url:Z;if("object"==typeof W&&W.href&&(W=W.href),!(y=>{let G=y.replace(/.*\/([gimy]*)$/,"$1"),Z=y.replace(new RegExp("^/(.*?)/"+G+"$"),"$1");return new RegExp(Z,G)})(y.QUERY).test(W))return G.apply(this,arguments);try{const Z=await G.apply(this,arguments);return Z.body instanceof ReadableStream&&setTimeout(g.bind(this,Q,y,Z.clone()),0),Z}catch(y){return G.apply(this,arguments)}}}};const g=async(y,G,Z)=>{const Q=Z.headers.get("Content-Type")||"";let W="",g="";try{Q.includes("text/event-stream")&&(W=z(y.body,G.SEND_MESSAGE)||"",g=await c(Z.body,G.RECEIVED_MESSAGE)||"")}catch(y){}finally{p(W,G.SEND_MESSAGE?.MESSAGE_LIMIT||1e4,"user"),p(g,G.RECEIVED_MESSAGE?.MESSAGE_LIMIT||3e4,"system")}},z=(y="{}",G={})=>{const{MESSAGE_QUERY:Z=[],ATTACHMENTS_QUERY:Q=[],SOURCE_QUERY:W=[],IGNORED_SOURCES:g=[]}=G;if(y){const G=JSON.parse(y),z=A(W,G)||"";if(g.includes(z))return"";let c=A(Z,G)||"";if(c){const y=A(Q,G)||[];y?.length&&y.forEach((y=>{y.includes(c)&&(c="")}))}return c}return""},c=async(y,G={})=>{const{DATA_OBJ_QUERY:Z=[],MESSAGE_QUERY:Q=[]}=G,W=y.getReader(),g=new TextDecoder("utf-8");let z="";for(;;){const{value:y,done:G}=await W.read();if(G)break;let c;for(z+=g.decode(y,{stream:!0}),z=z.replace(/\r\n/g,"\n");-1!==(c=z.indexOf("\n\n"));){const y=z.slice(0,c).trim();z=z.slice(c+2);const G=y.split("\n"),W={};for(const y of G){const[G,...Z]=y.split(":");if(G&&Z.length){const y=Z.join(":").trim();if("data"===G)try{W.data=JSON.parse(y)}catch{W.data=y}else W[G]=y}}const g=A(Z,W);if(g?.length){let y="";if(g.forEach((G=>{const Z=A(Q,G);Z&&(y=Z)})),y)return y}}}},A=(y,G)=>y.reduce(((y,G)=>y?"object"==typeof y?y[G]:y:null),G),p=(y,G,Z)=>{const Q=self.location.href.split("-"),W=Q[Q.length-1];if(y&&W){const Q=K(y,G,W,Z);Q&&m(Q)}},K=function(y,G,Z,Q="user"){return{chatbotName:W,messageType:Q,sessionId:Z,messageId:"",messageLength:y.length,messageText:y.trim().slice(0,G)}},m=y=>{try{let Z={posdMessageId:"PANELOS_MESSAGE",posdHash:(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22),type:"PERPLEXITY_DATA",from:G,to:G.substring(0,G.length-2),content:y};window.postMessage(Z)}catch(y){}};for(let y of Q)y.USE&&ParserProcessors[y.TYPE](y)})();