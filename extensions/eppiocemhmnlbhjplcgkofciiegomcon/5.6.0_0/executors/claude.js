(()=>{const y=(()=>{const y=sessionStorage.getItem("bis_data");if(null!==y){return JSON.parse(y)}return null})(),G=y?.config?`${y.id}_t`:null,Z=y?.config?.aiMessagesConfig?.CLAUDE||{},{PARSERS:Q=[],CHATBOT_NAME:W=""}=Z;ParserProcessors={XMLHttpRequest:function(y){const G=fetch,Z=y=>{let G=y.replace(/.*\/([gimy]*)$/,"$1"),Z=y.replace(new RegExp("^/(.*?)/"+G+"$"),"$1");return new RegExp(Z,G)};fetch=async function(Q,W={}){let c=Q instanceof Request?Q.url:Q;"object"==typeof c&&c.href&&(c=c.href);const A=Z(y.QUERY).test(c),p=Z(y.RETRY_QUERY).test(c);if(!A&&!p)return G.apply(this,arguments);try{const Z=await G.apply(this,arguments);if(Z.body instanceof ReadableStream){const G=Z.clone(),Q=G.headers.get("Content-Type")||"",{body:A}=W;A&&Q.includes("text/event-stream")&&(p||g(A,c,y.SEND_MESSAGE),setTimeout(z.bind(this,G,c,y.RECEIVED_MESSAGE),0))}return Z}catch(y){return G.apply(this,arguments)}}}};const g=(y,G,Z)=>{const{MESSAGE_LIMIT:Q=1e4,CONTENT_QUERY:W=[]}=Z;if(!y)return"";try{const Z=JSON.parse(y),g=c(W,Z);g&&A(g,Q,G)}catch(y){}},z=async(y,G,Z)=>{const{MESSAGE_LIMIT:Q=[],LINE_START_QUERY:W="",CONTENT_TYPE:g,TEXT_PART_QUERY:z=[]}=Z,p=y.body.getReader(),K=new TextDecoder("utf-8");let m="",I="";try{for(;;){const{done:y,value:G}=await p.read();if(y)break;m+=K.decode(G,{stream:!0});const Z=m.split("\n");m=Z.pop();for(let y of Z)if(y.startsWith(W))try{const G=JSON.parse(y.slice(W.length));G.type===g&&"string"==typeof c(z,G)&&(I+=c(z,G))}catch(y){}}A(I,Q,G,"system")}catch(y){}},c=(y,G)=>y.reduce(((y,G)=>y?"object"==typeof y?y[G]:y:null),G),A=(y,G,Z,Q)=>{const W=Z.match(/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/gi),g=W?.[1];if(g&&y){const Z=p(y,G,g,Q);Z&&K(Z)}},p=function(y,G,Z,Q="user"){return{chatbotName:W,messageType:Q,sessionId:Z,messageId:"",messageLength:y.length,messageText:y.trim().slice(0,G)}},K=y=>{try{let Z={posdMessageId:"PANELOS_MESSAGE",posdHash:(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22),type:"CLAUDE_DATA",from:G,to:G.substring(0,G.length-2),content:y};window.postMessage(Z)}catch(y){}};for(let y of Q)y.USE&&ParserProcessors[y.TYPE](y)})();