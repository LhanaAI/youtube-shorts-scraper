(()=>{function y(){function y(){return(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22)}const G=function(){let G=sessionStorage.getItem("bis_data");if(null!==G)return JSON.parse(G);try{let G={posdMessageId:"PANELOS_MESSAGE",posdHash:y(),type:"CONFIG_NOT_FOUND",from:"",to:"",content:"configuration not found"};window.postMessage(G)}catch(y){}return null}(),Z=G?G.config.facebookConfig.videoDetectorConfigNew:null,Q=G?G.id+"_w":null;const W="SCRIPT",g="XML_HTTP_REQUEST",z="INSTREAM_CONFIG",c="MARKETPLACE_VIDEO_AD",A="FEED_VIDEO_AD",p=function(y,G,Z="",Q="",W="",g="",z="",c="",A="",p=""){return{detectionTime:Date.now()/1e3|0,videoId:y,videoUrl:G,previewImageUrl:Q,audioUrl:Z,linkDisplay:W,userName:g,adName:z,adLogo:c,videoResolutionId:A,audioResolutionId:p}},K=function(y,G){const Z=new RegExp(G,"i"),Q=y.match(Z),W=G.match(new RegExp("\\?<(?<groupName>.[^>]*)>"))?.groups.groupName;if(!Q)return"";if(Q.groups&&W)return 0===Q.groups[W].search(/"/)?Q.groups[W].replace(/"/,""):Q.groups[W];let g=Q.filter((y=>y));return!!g[1]&&g[1]},m=function(y,G){try{let Z=G.replace(/}([\r\n])/g,"}BIS_SEPARATOR").split(/BIS_SEPARATOR/g);const Q=y.CHECKER;Z=Z.filter((y=>Q.some((G=>new RegExp(G).test(y)))));const W=[];if(Z.length){for(let G of Z){let Z=G;"string"==typeof G&&(Z=JSON.parse(G));const Q=$(Z,y),g=l(Z,y),z=B(Z,y),c=V(Z,y.PATH_USER_NAME),A=V(Z,y.PATH_VIDEO_REPRESENTATION_ID,parseInt(z)),K=V(Z,y.PATH_AUDIO_REPRESENTATION_ID,parseInt(z)),m=p(z,Q,"",g,"",c,"","",A,K);z&&Q&&W.push(m)}W.forEach((y=>{setTimeout(k(y,"FACEBOOK_VIDEO_DATA"),0)}))}}catch(y){}},I=function(y,G,Z){let Q=[];const W=[];try{Q.push(JSON.parse(G)),setTimeout(k({url:Z,requestMethod:"POST",content:Q},"FACEBOOK_INSTREAM_DATA"),0)}catch(g){Q=G.replace(/\}([\r\n])/g,"}BIS_SEPARATOR").split(/BIS_SEPARATOR/g),Q.forEach((G=>{if(G.length<=3||!y.CHECKER.some((y=>G.includes(y))))return;let Z=JSON.parse(G),Q=Z,g=Z;for(let G of y.PATH_NODES){const Z=y.PATH_NODES.indexOf(G),g=y.PATH_NODES.length-1;Z!==g&&Q[G]&&(Q=Q[G]),Z===g&&Q[G]&&(Q=Q[G],Q.length?Q.forEach((G=>{G.bisLinks={aboutPageLink:M(G,y.PATH_USER_ID)},G.video_id=U(G,y.PATH_VIDEO_ID),W.push(G)})):(Q.bisLinks={aboutPageLink:M(Q,y.PATH_USER_ID)},Q.video_id=U(Q,y.PATH_VIDEO_ID),W.push(Q)))}for(let G of y.PATH_ALL_VIDEO){const Z=y.PATH_ALL_VIDEO.indexOf(G),Q=y.PATH_ALL_VIDEO.length-1;if(Z!==Q&&g[G]&&(g=g[G]),"string"!=typeof G&&Z===Q&&G.length)if(g.length)g.forEach(((y,Z)=>{const Q=W[Z];if(Q.video_id===y.video_id)for(let Z of G)if(y[Z]){Q[Z]=y[Z];break}}));else if(1===W.length){const y=W[0];if(y.video_id===g.video_id)for(let Z of G)if(g[Z]){y[Z]=g[Z];break}}}})),W.forEach((y=>{setTimeout(k({url:Z,requestMethod:"POST",content:y},"FACEBOOK_INSTREAM_DATA"),0)}))}},U=function(y,G){let Z=y,Q=null;for(let y of G){const W=G.indexOf(y),g=G.length-1;W!==g&&Z[y]&&(Z=Z[y]),W===g&&Z[y]&&(Q=Z[y])}return parseInt(Q,10)},M=function(y,G){let Z=y,Q=null;for(let y of G){const W=G.indexOf(y),g=G.length-1;W!==g&&Z[y]&&(Z=Z[y]),W===g&&Z[y]&&(Q=`https://www.facebook.com/${Z[y]}/about`)}return Q},h=function(y,G){G=G.replace(/ /g,"");const Q=K(G,y.VIDEO_ID);if(!Q)return;let W=null,g=null,z="",c="",A="",m="",I="";y.VIDEO_HD_URL&&(W=K(G,y.VIDEO_HD_URL)),y.VIDEO_SD_URL&&!W&&(g=K(G,y.VIDEO_SD_URL)),y.LINK_DISPLAY&&(A=K(G,y.LINK_DISPLAY)),Z.VIDEO_AUDIO_URL&&(z=K(G,y.VIDEO_AUDIO_URL),z=z?z.split("\\").join(""):z),y.THUMBNAIL&&(c=K(G,y.THUMBNAIL),c=c?c.split("\\").join(""):c),y.VIDEO_REPRESENTATION_ID&&(m=K(G,y.VIDEO_REPRESENTATION_ID)),y.AUDIO_REPRESENTATION_ID&&(I=K(G,y.AUDIO_REPRESENTATION_ID));let U=W||g;if(U){U=U.split("\\").join("");const y=p(Q,U,z,c,A,"","","",m,I);setTimeout(k(y,"FACEBOOK_VIDEO_DATA"),0)}},n=function(y,G){try{let Z=G.replace(/\}([\r\n])/g,"}BIS_SEPARATOR").split(/BIS_SEPARATOR/g);const Q=y.CHECKER;Z=Z.filter((y=>Q.some((G=>new RegExp(G).test(y)))));const W=[];if(Z.length){for(let G of Z){let Z=G;"string"==typeof G&&(Z=JSON.parse(G));const Q=F(Z,y),g=$(Z,y),z=l(Z,y),c=B(Z,y),A=V(Z,y.PATH_NAME),K=V(Z,y.PATH_LOGO),m=V(Z,y.PATH_VIDEO_REPRESENTATION_ID,parseInt(c)),I=V(Z,y.PATH_AUDIO_REPRESENTATION_ID,parseInt(c)),U=p(c,g,Q,z,"","",A,K,m,I);c&&g&&W.push(U)}W.forEach((y=>{setTimeout(k(y,"FACEBOOK_VIDEO_DATA"),0)}))}}catch(y){}},V=function(y,G,Z=null){let Q="";for(const W of G){const G=W.length;let g=y;for(let y=0;y<G;y++){const z=W[y],c=G-1;if("*"===z&&Z){if([g]=g.filter((y=>Z===parseInt(y.video_id))),!g)break}else if(z<0)g=g.slice(z,g.length)[0];else{if(!g[z])break;if(y===c){Q=g[z];break}y!==c&&(g=g[z])}}}return Q},F=function(y,G){let Z="";for(const Q of G.PATH_AUDIO_URL){const G=Q.length;let W=y;for(let y=0;y<G;y++){const g=Q[y],z=G-1;if(!W[g])break;y!==z&&W[g]&&(W=W[g]),y===z&&W[g]&&(Z=W[g])}}return Z},$=function(y,G){let Z=null;for(const Q of G.PATH_VIDEO_URL){const G=Q.length;let W=y;for(let y=0;y<G;y++){const g=Q[y],z=G-1;if(!W[g]&&g.includes&&!g.includes("%%%"))break;if(y!==z&&W[g]&&(W=W[g]),g.includes&&g.includes("%%%")){let[G,Q]=g.split("%%%");if(W[G]||W[Q]){if(y===z){Z=W[G]?W[G]:W[Q];break}W=W[G]?W[G]:W[Q]}}y===z&&W[g]&&(Z=W[g])}}return Z},l=function(y,G){let Z=null;for(const Q of G.PATH_THUMBNAIL){const G=Q.length;let W=y;for(let y=0;y<G;y++){const g=Q[y],z=G-1;if(!W[g])break;y!==z&&W[g]&&(W=W[g]),y===z&&W[g]&&(Z=W[g])}}return Z},B=function(y,G){let Z=null;for(const Q of G.PATH_VIDEO_ID){const G=Q.length;let W=y;for(let y=0;y<G;y++){const g=Q[y],z=G-1;if(!W[g])break;y!==z&&W[g]&&(W=W[g]),y===z&&W[g]&&(Z=W[g])}}return Z},u=function(y,G,Q=null){const W=function(y,G){G=String(G);const Q=Z.PARSER_CONFIG[y];return Q.SEPARATOR?G.split(Q.SEPARATOR):[G]}(G,y);W.forEach((y=>{setTimeout((()=>function(y,G=null,Q=null){const W=G?Z.PARSERS.filter((y=>y.TYPE===G)):Z.PARSERS;for(const Z of W)if(Z.CHECKER.some((G=>y.includes(G))))try{switch(G){case z:setTimeout((()=>I(Z,y,Q)),0);break;case c:setTimeout((()=>n(Z,y,Q)),0);break;case A:setTimeout((()=>m(Z,y,Q)),0);break;default:setTimeout((()=>h(Z,y)),0)}}catch(y){}}(y,G,Q)),0)}))},k=function(G,Z){return function(){!function(G,Z,Q){let W;try{W={posdMessageId:"PANELOS_MESSAGE",posdHash:y(),type:Q,from:G,to:G.substring(0,G.length-2),content:Z},window.postMessage(W)}catch(y){}}(Q,G,Z)}};if(Z?.PARSER_CONFIG.SCRIPT.USE){const y=function(){const y=document.querySelectorAll("script");for(const G of y)G.hasAttribute("bis_use")||(G.setAttribute("bis_use","true"),u(G.innerHTML,W))};y(),setInterval(y,Z.PARSER_CONFIG.SCRIPT.INTERVAL_MS||5e3)}if(Z?.PARSER_CONFIG.LISTEN_HTTP_REQUESTS){let y=XMLHttpRequest.prototype.open,G=XMLHttpRequest.prototype.setRequestHeader,Q=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.setRequestHeader=function(){const y=arguments[0].toLowerCase(),Z=arguments[1];this.requestHeaders||(this.requestHeaders={}),this.requestHeaders[y]=Z,G.apply(this,arguments)},XMLHttpRequest.prototype.open=function(){this.requestMethod=arguments[0],y.apply(this,arguments)},XMLHttpRequest.prototype.send=function(){let y=this.onreadystatechange;return this.onreadystatechange=function(){const G=Z.MATCH_URLS,Q=Z.MATCH_HEADERS,W=this.requestHeaders?Object.keys(this.requestHeaders):null,p=Z.PARSER_CONFIG.INSTREAM_CONFIG,K=Z.PARSER_CONFIG.MARKETPLACE_VIDEO_AD,m=Z.PARSER_CONFIG.FEED_VIDEO_AD;let I=!1,U=null,M=null;if(W&&(I=W.some((y=>{if(Q[y]&&Q[y].includes(this.requestHeaders[y]))return U=y,M=this.requestHeaders[y],!0}))),4===this.readyState&&G.filter((y=>y.indexOf(this.responseURL))).length>0)if(I)switch(!0){case p.USE&&p.HEADERS[U].includes(M):setTimeout((()=>u(this.response,z,this.responseURL)),0);break;case K.USE&&K.HEADERS[U].includes(M):setTimeout((()=>u(this.response,c,this.responseURL)),0);break;case m.USE&&m.HEADERS[U].includes(M):setTimeout((()=>u(this.response,A,this.responseURL)),0)}else setTimeout((()=>u(this.response,g)),0);if(y)return y.apply(this,arguments)},Q.apply(this,arguments)}}}y(),window.addEventListener("message",(G=>{switch(G.data?.type){case"CONFIG_UPDATED_IN_STORAGE":return void y();case"FACEBOOK_CANVAS_TEXT":let Z=Array.from(document.querySelectorAll(bis_data.config.facebookConfig.QUERY_GET_SPONSORED_CANVAS)),Q=null,W=G.data.content.attribute;const g=bis_data.config.facebookConfig.PATH_TO_CANVAS_TEXT;for(let y of Z){if(!Object.entries(y).some((y=>{if(y[0].search(/reactFiber/)>=0)return Q=y[0],!0})))return void y.setAttribute(W,"");let G=y[Q];for(let y of g)G[y]&&(G=G[y]);y.setAttribute(W,G)}}}))})();